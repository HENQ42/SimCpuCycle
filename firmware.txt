; === SHELL "BUFFERED" SYSTEM ===
; Digite varias letras (elas ficarao invisiveis)
; Aperte 'l' para mostrar tudo de uma vez.
; Aperte 'z' para sair.

; --- Loop Principal ---
INICIO:
    ADD #0      
    JUMP INICIO 

; --- Driver de Teclado (ISR) ---
ORG 500
HANDLER:
    PUSH        ; 1. Salva o contexto (ACC do loop principal)

    ; --- LEITURA E BACKUP ---
    LOAD 61440  ; Lê do Teclado (0xF000)
    STORE 100   ; Salva backup na RAM[100] (Var: TeclaAtual)

    ; --- VERIFICACAO: É 'z'? (Sair) ---
    LOAD 100    ; Recarrega Tecla
    SUB #122    ; 'z' = 122
    JEQ DESLIGAR

    ; --- VERIFICACAO: É 'l'? (Flush) ---
    LOAD 100    ; Recarrega Tecla
    SUB #108    ; 'l' = 108
    JEQ FAZER_FLUSH

    ; --- CASO PADRAO: Acumular no Buffer ---
    ; Se não é 'z' nem 'l', guardamos no display sem mostrar.
    LOAD 100    ; Recarrega Tecla
    STORE 57344 ; Escreve no DATA REGISTER (0xE000) - Bufferiza
    JUMP SAIR   ; Fim da interrupcao

FAZER_FLUSH:
    ; O usuario apertou 'l'. Vamos mandar o comando de imprimir.
    LOAD #1     ; Comando 1 = FLUSH
    STORE 57345 ; Escreve no COMMAND REGISTER (0xE001)
    JUMP SAIR

SAIR:
    POP         ; Restaura o contexto original
    RET         ; Volta para o loop principal

DESLIGAR:
    HALT